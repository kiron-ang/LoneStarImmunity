<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lone Star Immunity</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            background-color: #1a1a1a;
            color: #ffffff;
            font-family: Arial, sans-serif;
            text-align: center;
        }
        svg {
            display: block;
            margin: auto;
        }
        .star {
            transition: r 0.2s ease;
        }
        .tooltip {
            position: absolute;
            background: rgba(255, 149, 0, 0.9);
            color: #000;
            padding: 5px;
            border-radius: 5px;
            display: none;
        }
    </style>
</head>
<body>
    <h1>Lone Star Immunity</h1>
    <p>Hover over a star to see vaccination rates.</p>
    <svg width="800" height="600" aria-label="Visualization of vaccination coverage as a starfield"></svg>
    <div id="tooltip" class="tooltip" role="tooltip"></div>

    <script>
        const width = 800, height = 600;
        const svg = d3.select("svg");
        const tooltip = d3.select("#tooltip");
        const fileUrl = "data.csv";

        d3.csv(fileUrl).then(data => {
            console.log("Parsed Data:", data); // Debugging line to check column names
            processData(data);
        }).catch(error => console.error("Error loading the file:", error));

        function processData(data) {
            const schools = data.slice(2).map((d, i) => { // Skip the first two rows
                const name = (d["Unnamed: 2"] || "").trim();
                const rate = parseFloat((d["Unnamed: 9"] || "0").toString().replace("%", "")) / 100;
                
                return {
                    name: name || `School ${i + 1}`,
                    vaccinationRate: isNaN(rate) ? 0 : rate,
                    x: Math.random() * width,
                    y: Math.random() * height
                };
            }).filter(d => d.vaccinationRate > 0);

            svg.selectAll(".star").remove();

            svg.selectAll(".star")
                .data(schools)
                .enter().append("circle")
                .attr("class", "star")
                .attr("cx", d => d.x)
                .attr("cy", d => d.y)
                .attr("r", d => 4 + d.vaccinationRate * 10) // Adjust size based on rate
                .attr("fill", d => d3.interpolateOranges(d.vaccinationRate))
                .attr("tabindex", 0)
                .on("mouseover focus", function (event, d) {
                    d3.select(this).attr("r", d => 8 + d.vaccinationRate * 10); // Enlarge instead of scaling
                    tooltip.style("display", "block")
                        .html(`${d.name}: ${(d.vaccinationRate * 100).toFixed(1)}% vaccinated`)
                        .style("left", `${event.pageX + 10}px`)
                        .style("top", `${event.pageY - 10}px`);
                })
                .on("mouseout blur", function (event, d) {
                    d3.select(this).attr("r", d => 4 + d.vaccinationRate * 10); // Restore original size
                    tooltip.style("display", "none");
                });
        }
    </script>
</body>
</html>
